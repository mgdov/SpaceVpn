{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ab/Documents/code/SpaceVPN/SpaceVpn/lib/api.ts"],"sourcesContent":["/**\n * API Client for SpaceVPN Backend\n */\n\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'\nconst API_V1 = process.env.NEXT_PUBLIC_API_V1 || '/api/v1'\n\nexport const API_BASE_URL = `${API_URL}${API_V1}`\n\n/**\n * API Response types\n */\nexport interface ApiResponse<T = any> {\n  data?: T\n  error?: string\n  message?: string\n}\n\nexport interface User {\n  id: string\n  username: string\n  email: string | null\n  is_active: boolean\n  is_superuser: boolean\n  created_at: string\n  updated_at: string\n}\n\nexport interface TokenResponse {\n  access_token: string\n  token_type: string\n}\n\nexport interface VPNConfig {\n  config_json: string\n  qr_code_base64: string\n}\n\nexport interface Subscription {\n  id: string\n  user_id: string\n  start_date: string\n  end_date: string\n  data_limit_gb: number\n  data_used_gb: number\n  is_active: boolean\n}\n\n/**\n * Get auth token from localStorage\n */\nexport function getAuthToken(): string | null {\n  if (typeof window === 'undefined') return null\n  return localStorage.getItem('auth_token')\n}\n\n/**\n * Set auth token in localStorage\n */\nexport function setAuthToken(token: string): void {\n  if (typeof window === 'undefined') return\n  localStorage.setItem('auth_token', token)\n}\n\n/**\n * Remove auth token from localStorage\n */\nexport function removeAuthToken(): void {\n  if (typeof window === 'undefined') return\n  localStorage.removeItem('auth_token')\n}\n\n/**\n * Get current user from localStorage\n */\nexport function getCurrentUser(): User | null {\n  if (typeof window === 'undefined') return null\n  const userJson = localStorage.getItem('current_user')\n  return userJson ? JSON.parse(userJson) : null\n}\n\n/**\n * Set current user in localStorage\n */\nexport function setCurrentUser(user: User): void {\n  if (typeof window === 'undefined') return\n  localStorage.setItem('current_user', JSON.stringify(user))\n}\n\n/**\n * Remove current user from localStorage\n */\nexport function removeCurrentUser(): void {\n  if (typeof window === 'undefined') return\n  localStorage.removeItem('current_user')\n}\n\n/**\n * Make authenticated API request\n */\nasync function apiRequest<T = any>(\n  endpoint: string,\n  options: RequestInit = {}\n): Promise<ApiResponse<T>> {\n  const token = getAuthToken()\n  \n  const headers: HeadersInit = {\n    'Content-Type': 'application/json',\n    ...options.headers,\n  }\n  \n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`\n  }\n  \n  try {\n    const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n      ...options,\n      headers,\n    })\n    \n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}))\n      return {\n        error: errorData.detail || errorData.message || `HTTP ${response.status}`,\n      }\n    }\n    \n    const data = await response.json()\n    return { data }\n  } catch (error) {\n    return {\n      error: error instanceof Error ? error.message : 'Network error',\n    }\n  }\n}\n\n/**\n * Register new user\n */\nexport async function registerUser(\n  username: string,\n  email: string,\n  password: string\n): Promise<ApiResponse<User>> {\n  return apiRequest<User>('/register', {\n    method: 'POST',\n    body: JSON.stringify({ username, email, password }),\n  })\n}\n\n/**\n * Login user\n */\nexport async function loginUser(\n  username: string,\n  password: string\n): Promise<ApiResponse<TokenResponse>> {\n  const formData = new URLSearchParams()\n  formData.append('username', username)\n  formData.append('password', password)\n  \n  const response = await apiRequest<TokenResponse>('/token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: formData.toString(),\n  })\n  \n  // If successful, save token\n  if (response.data?.access_token) {\n    setAuthToken(response.data.access_token)\n  }\n  \n  return response\n}\n\n/**\n * Get current user info\n */\nexport async function getCurrentUserInfo(): Promise<ApiResponse<User>> {\n  const response = await apiRequest<User>('/users/me')\n  \n  // Save user info\n  if (response.data) {\n    setCurrentUser(response.data)\n  }\n  \n  return response\n}\n\n/**\n * Logout user\n */\nexport function logoutUser(): void {\n  removeAuthToken()\n  removeCurrentUser()\n}\n\n/**\n * Create VPN client\n */\nexport async function createVPNClient(): Promise<ApiResponse<any>> {\n  return apiRequest('/vpn-clients/', {\n    method: 'POST',\n  })\n}\n\n/**\n * Get VPN client config\n */\nexport async function getVPNConfig(): Promise<ApiResponse<VPNConfig>> {\n  return apiRequest<VPNConfig>('/vpn-clients/me/config')\n}\n\n/**\n * Get user subscriptions\n */\nexport async function getUserSubscriptions(): Promise<ApiResponse<Subscription[]>> {\n  return apiRequest<Subscription[]>('/subscriptions/')\n}\n\n/**\n * Create subscription\n */\nexport async function createSubscription(\n  userId: string,\n  endDate: string,\n  dataLimitGB: number = 0\n): Promise<ApiResponse<Subscription>> {\n  return apiRequest<Subscription>('/subscriptions/', {\n    method: 'POST',\n    body: JSON.stringify({\n      user_id: userId,\n      end_date: endDate,\n      data_limit_gb: dataLimitGB,\n    }),\n  })\n}\n\n/**\n * Check if user is authenticated\n */\nexport function isAuthenticated(): boolean {\n  return getAuthToken() !== null\n}\n\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEe;AAAhB,MAAM,UAAU,gEAAmC;AACnD,MAAM,SAAS,+CAAkC;AAE1C,MAAM,eAAe,GAAG,UAAU,QAAQ;AA4C1C,SAAS;IACd;;IACA,OAAO,aAAa,OAAO,CAAC;AAC9B;AAKO,SAAS,aAAa,KAAa;IACxC;;IACA,aAAa,OAAO,CAAC,cAAc;AACrC;AAKO,SAAS;IACd;;IACA,aAAa,UAAU,CAAC;AAC1B;AAKO,SAAS;IACd;;IACA,MAAM,WAAW,aAAa,OAAO,CAAC;IACtC,OAAO,WAAW,KAAK,KAAK,CAAC,YAAY;AAC3C;AAKO,SAAS,eAAe,IAAU;IACvC;;IACA,aAAa,OAAO,CAAC,gBAAgB,KAAK,SAAS,CAAC;AACtD;AAKO,SAAS;IACd;;IACA,aAAa,UAAU,CAAC;AAC1B;AAEA;;CAEC,GACD,eAAe,WACb,QAAgB,EAChB,UAAuB,CAAC,CAAC;IAEzB,MAAM,QAAQ;IAEd,MAAM,UAAuB;QAC3B,gBAAgB;QAChB,GAAG,QAAQ,OAAO;IACpB;IAEA,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;IAC9C;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,GAAG,eAAe,UAAU,EAAE;YACzD,GAAG,OAAO;YACV;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;YACvD,OAAO;gBACL,OAAO,UAAU,MAAM,IAAI,UAAU,OAAO,IAAI,CAAC,KAAK,EAAE,SAAS,MAAM,EAAE;YAC3E;QACF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,OAAO;YAAE;QAAK;IAChB,EAAE,OAAO,OAAO;QACd,OAAO;YACL,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD;IACF;AACF;AAKO,eAAe,aACpB,QAAgB,EAChB,KAAa,EACb,QAAgB;IAEhB,OAAO,WAAiB,aAAa;QACnC,QAAQ;QACR,MAAM,KAAK,SAAS,CAAC;YAAE;YAAU;YAAO;QAAS;IACnD;AACF;AAKO,eAAe,UACpB,QAAgB,EAChB,QAAgB;IAEhB,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,YAAY;IAC5B,SAAS,MAAM,CAAC,YAAY;IAE5B,MAAM,WAAW,MAAM,WAA0B,UAAU;QACzD,QAAQ;QACR,SAAS;YACP,gBAAgB;QAClB;QACA,MAAM,SAAS,QAAQ;IACzB;IAEA,4BAA4B;IAC5B,IAAI,SAAS,IAAI,EAAE,cAAc;QAC/B,aAAa,SAAS,IAAI,CAAC,YAAY;IACzC;IAEA,OAAO;AACT;AAKO,eAAe;IACpB,MAAM,WAAW,MAAM,WAAiB;IAExC,iBAAiB;IACjB,IAAI,SAAS,IAAI,EAAE;QACjB,eAAe,SAAS,IAAI;IAC9B;IAEA,OAAO;AACT;AAKO,SAAS;IACd;IACA;AACF;AAKO,eAAe;IACpB,OAAO,WAAW,iBAAiB;QACjC,QAAQ;IACV;AACF;AAKO,eAAe;IACpB,OAAO,WAAsB;AAC/B;AAKO,eAAe;IACpB,OAAO,WAA2B;AACpC;AAKO,eAAe,mBACpB,MAAc,EACd,OAAe,EACf,cAAsB,CAAC;IAEvB,OAAO,WAAyB,mBAAmB;QACjD,QAAQ;QACR,MAAM,KAAK,SAAS,CAAC;YACnB,SAAS;YACT,UAAU;YACV,eAAe;QACjB;IACF;AACF;AAKO,SAAS;IACd,OAAO,mBAAmB;AAC5B"}}]
}