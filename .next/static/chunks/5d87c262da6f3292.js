(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,49051,t=>{"use strict";let e="/api/v1";function r(){return localStorage.getItem("auth_token")}function n(){let t=localStorage.getItem("current_user");return t?JSON.parse(t):null}async function i(t,n={}){let a=r(),s="undefined"!=typeof FormData&&n.body instanceof FormData,o=new Headers(n.headers||{});o.has("Accept")||o.set("Accept","application/json");let u=void 0!==n.body&&null!==n.body&&""!==n.body;s||!u||o.has("Content-Type")||o.set("Content-Type","application/json"),a&&!o.has("Authorization")&&o.set("Authorization",`Bearer ${a}`);try{let r=await fetch(function(t){let r=e.endsWith("/")?e.slice(0,-1):e;if(!t||"/"===t)return`${r}/`;let n=t.startsWith("/")?t:`/${t}`;return`${r}${n}`}(t),{...n,headers:o}),i=r.status,a=await r.text(),s=a?function(t){try{return JSON.parse(t)}catch{return t}}(a):void 0;if(!r.ok){if(422===i&&Array.isArray(s?.detail))return{error:s.detail.map(t=>`${t.loc?.join(" → ")||"Field"}: ${t.msg}`).join(", "),status:i};let t=s?.detail||s?.message||(Array.isArray(s?.errors)?s?.errors.join(", "):void 0);return{error:"string"==typeof t?t:`HTTP ${i}`,status:i}}return{data:s,status:i}}catch(t){return{error:t instanceof Error?t.message:"Network error"}}}async function a(t,e,r,n){return i("/auth/register",{method:"POST",body:JSON.stringify({username:t,email:e,password:r,full_name:n})})}async function s(t,e){var r;let n=new URLSearchParams;n.append("username",t),n.append("password",e);let a=await i("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});return a.data?.access_token&&(r=a.data.access_token,localStorage.setItem("auth_token",r)),a}function o(){localStorage.removeItem("auth_token"),localStorage.removeItem("current_user")}function u(){return null!==r()}async function c(){var t;let e=await i("/users/me");return e.data&&(t=e.data,localStorage.setItem("current_user",JSON.stringify(t))),e}async function l(){return i("/users/me/vpn")}async function d(t){return i(function(t,e){if(!e)return t;let r=new URLSearchParams;Object.entries(e).forEach(([t,e])=>{null!=e&&r.append(t,String(e))});let n=r.toString();return n?`${t}?${n}`:t}("/admin/users/",t))}async function f(){return i("/subscriptions/")}async function y(){return i("/admin/subscriptions/")}async function m(){return i("/tariffs/")}async function g(){return i("/admin/tariffs/")}async function h(t){return i("/admin/tariffs/",{method:"POST",body:JSON.stringify(t)})}async function p(t,e){return i(`/admin/tariffs/${t}`,{method:"PATCH",body:JSON.stringify(e)})}async function S(t){return i(`/admin/tariffs/${t}`,{method:"DELETE"})}async function P(t){return i(`/admin/tariffs/${t}/toggle`,{method:"POST"})}async function v(t){return i("/subscriptions/purchase-free",{method:"POST",body:JSON.stringify(t)})}async function T(t){return i("/vpn-clients/",{method:"POST",body:JSON.stringify(t)})}async function U(){return i("/vpn-clients/")}async function C(t){return i(`/vpn-clients/${t}/config`)}async function N(t,e){return i(`/vpn-clients/${t}/regenerate`,{method:"POST",body:e?JSON.stringify(e):void 0})}async function b(t){return i(`/vpn-clients/${t}/sync`,{method:"POST"})}async function O(){return i("/admin/vpn/clients/")}async function w(t){return i("/admin/vpn/clients/",{method:"POST",body:JSON.stringify(t)})}async function A(t,e){return i(`/admin/vpn/clients/${t}`,{method:"PUT",body:JSON.stringify(e)})}async function $(t){return i(`/admin/vpn/clients/${t}`,{method:"DELETE"})}async function E(t,e){return i(`/admin/vpn/clients/${t}/extend`,{method:"POST",body:e?JSON.stringify(e):void 0})}t.s(["adminCreateTariff",()=>h,"adminCreateVPNClient",()=>w,"adminDeleteTariff",()=>S,"adminDeleteVPNClient",()=>$,"adminExtendVPNClient",()=>E,"adminListSubscriptions",()=>y,"adminListTariffs",()=>g,"adminListUsers",()=>d,"adminListVPNClients",()=>O,"adminToggleTariff",()=>P,"adminUpdateTariff",()=>p,"adminUpdateVPNClient",()=>A,"createUserVPNClient",()=>T,"getCurrentUser",()=>n,"getCurrentUserInfo",()=>c,"getPublicTariffs",()=>m,"getUserSubscriptions",()=>f,"getUserVPNClientConfig",()=>C,"getUserVPNStatus",()=>l,"isAuthenticated",()=>u,"listUserVPNClients",()=>U,"loginUser",()=>s,"logoutUser",()=>o,"purchaseFreeTariff",()=>v,"regenerateUserVPNClient",()=>N,"registerUser",()=>a,"syncUserVPNClient",()=>b])},84654,(t,e,r)=>{e.exports=t.r(61938)},96636,t=>{"use strict";var e=t.i(3422),r=t.i(20278),n=t.i(84654),i=t.i(49051);let a=(0,r.createContext)(void 0);function s({children:t}){let[s,o]=(0,r.useState)(null),[u,c]=(0,r.useState)(!0),l=(0,n.useRouter)();(0,r.useEffect)(()=>{(async()=>{if((0,i.isAuthenticated)()){let t=(0,i.getCurrentUser)();t&&o(t);let e=await (0,i.getCurrentUserInfo)();e.data?o(e.data):e.error&&((0,i.logoutUser)(),o(null))}c(!1)})()},[]);let d=async(t,e)=>{c(!0);try{let r=await (0,i.loginUser)(t,e);if(r.data){let t=await (0,i.getCurrentUserInfo)();if(t.data)return o(t.data),c(!1),{success:!0}}return c(!1),{success:!1,error:r.error||"Login failed"}}catch(t){return c(!1),{success:!1,error:t instanceof Error?t.message:"Login failed"}}},f=async(t,e,r,n)=>{c(!0);try{let a=await (0,i.registerUser)(t,e,r,n);if(a.data)return await d(t,r);return c(!1),{success:!1,error:a.error||"Registration failed"}}catch(t){return c(!1),{success:!1,error:t instanceof Error?t.message:"Registration failed"}}},y=async()=>{if((0,i.isAuthenticated)()){let t=await (0,i.getCurrentUserInfo)();t.data&&o(t.data)}};return(0,e.jsx)(a.Provider,{value:{user:s,loading:u,login:d,logout:()=>{(0,i.logoutUser)(),o(null),l.push("/login")},register:f,refreshUser:y},children:t})}function o(){let t=(0,r.useContext)(a);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}function u(t){return function(i){let{user:a,loading:s}=o(),u=(0,n.useRouter)();return((0,r.useEffect)(()=>{s||a||u.push("/login")},[a,s,u]),s)?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,e.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):a?(0,e.jsx)(t,{...i}):null}}t.s(["AuthProvider",()=>s,"useAuth",()=>o,"withAuth",()=>u])}]);