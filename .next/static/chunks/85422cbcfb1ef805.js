(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25121,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},84654,(e,t,r)=>{t.exports=e.r(61938)},96134,50419,74349,e=>{"use strict";e.i(77442);function t(){return localStorage.getItem("auth_token")}function r(e){localStorage.setItem("auth_token",e)}function a(){localStorage.removeItem("auth_token")}async function n(e,r={}){let a=t(),o="undefined"!=typeof FormData&&r.body instanceof FormData,s=new Headers(r.headers||{});s.has("Accept")||s.set("Accept","application/json");let u=void 0!==r.body&&null!==r.body&&""!==r.body;o||!u||s.has("Content-Type")||s.set("Content-Type","application/json"),a&&!s.has("Authorization")&&s.set("Authorization",`Bearer ${a}`);let i=e.startsWith("http")?e:`https://space-vpn.tech/api/v1${e}`;try{let e=await fetch(i,{...r,headers:s}),t=e.status,a=await e.text(),n=a?function(e){try{return JSON.parse(e)}catch{return e}}(a):void 0;if(!e.ok){if(422===t&&Array.isArray(n?.detail))return{error:n.detail.map(e=>`${e.loc?.join(" → ")||"Field"}: ${e.msg}`).join(", "),status:t};let e=n?.detail||n?.message||(Array.isArray(n?.errors)?n?.errors.join(", "):void 0);return{error:"string"==typeof e?e:`HTTP ${t}`,status:t}}return{data:n,status:t}}catch(e){return{error:e instanceof Error?e.message:"Network error"}}}function o(e,t){if(!t)return e;let r=new URLSearchParams;Object.entries(t).forEach(([e,t])=>{null!=t&&r.append(e,String(t))});let a=r.toString();return a?`${e}?${a}`:e}async function s(e,t,r,a){return n("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,full_name:a})})}async function u(e,t){let a=new URLSearchParams;a.append("username",e),a.append("password",t);let o=await n("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});return o.data?.access_token&&r(o.data.access_token),o}function i(){a(),localStorage.removeItem("current_user")}function c(){return null!==localStorage.getItem("auth_token")}async function l(){return n("/auth/oauth-providers")}async function d(){return n("/auth/google")}async function g(){return n("/auth/telegram")}async function f(e){let t=await n("/auth/telegram/callback",{method:"POST",body:JSON.stringify(e)});return t.data?.access_token&&r(t.data.access_token),t}async function h(){let e=await n("/users/me");return e.data&&localStorage.setItem("current_user",JSON.stringify(e.data)),e}function m(){let e=localStorage.getItem("current_user");return e?JSON.parse(e):null}function y(){return m()}function p(e){localStorage.setItem("current_user",JSON.stringify(e))}e.s(["fetchAPI",()=>n,"getAuthToken",()=>t,"removeAuthToken",()=>a,"setAuthToken",()=>r,"withQuery",()=>o],50419),e.s(["getGoogleAuthUrl",()=>d,"getOAuthProviders",()=>l,"getTelegramAuthInfo",()=>g,"isAuthenticated",()=>c,"loginUser",()=>u,"logoutUser",()=>i,"registerUser",()=>s,"telegramAuthCallback",()=>f],96134),e.s(["getCurrentUser",()=>y,"getCurrentUserInfo",()=>h,"getStoredUser",()=>m,"setCurrentUser",()=>p],74349)},96636,e=>{"use strict";var t=e.i(19212),r=e.i(20278),a=e.i(84654),n=e.i(96134),o=e.i(74349);let s=(0,r.createContext)(void 0);function u({children:e}){let[u,i]=(0,r.useState)(null),[c,l]=(0,r.useState)(!0),d=(0,a.useRouter)();(0,r.useEffect)(()=>{(async()=>{if((0,n.isAuthenticated)()){let e=(0,o.getStoredUser)();e&&i(e);let t=await (0,o.getCurrentUser)();t.data?i(t.data):401===t.status||403===t.status?((0,n.logoutUser)(),i(null)):e||i(null)}l(!1)})()},[]);let g=async(e,t)=>{l(!0);try{let r=await (0,n.loginUser)(e,t);if(r.data){let e=await (0,o.getCurrentUser)();if(e.data)return i(e.data),localStorage.setItem("current_user",JSON.stringify(e.data)),l(!1),{success:!0}}return l(!1),{success:!1,error:r.error||"Login failed"}}catch(e){return l(!1),{success:!1,error:e instanceof Error?e.message:"Login failed"}}},f=async(e,t,r,a)=>{l(!0);try{let o=await (0,n.registerUser)(e,t,r,a);if(o.data){let t=o.data.username||o.data.email||e;return await g(t,r)}return l(!1),{success:!1,error:o.error||"Registration failed"}}catch(e){return l(!1),{success:!1,error:e instanceof Error?e.message:"Registration failed"}}},h=async()=>{if((0,n.isAuthenticated)()){let e=await (0,o.getCurrentUser)();e.data?(i(e.data),localStorage.setItem("current_user",JSON.stringify(e.data))):(401===e.status||403===e.status)&&((0,n.logoutUser)(),i(null))}};return(0,t.jsx)(s.Provider,{value:{user:u,loading:c,login:g,logout:()=>{(0,n.logoutUser)(),i(null),d.push("/login")},register:f,refreshUser:h},children:e})}function i(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(e){return function(n){let{user:o,loading:s}=i(),u=(0,a.useRouter)();return((0,r.useEffect)(()=>{s||o||u.push("/login")},[o,s,u]),s)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):o?(0,t.jsx)(e,{...n}):null}}e.s(["AuthProvider",()=>u,"useAuth",()=>i,"withAuth",()=>c])}]);