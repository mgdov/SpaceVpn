(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84654,(t,e,r)=>{e.exports=t.r(61938)},96636,50419,t=>{"use strict";var e=t.i(19212),r=t.i(20278),a=t.i(84654);t.i(77442);function n(t){localStorage.setItem("auth_token",t)}function o(){localStorage.removeItem("auth_token")}async function s(t,e={}){let r=localStorage.getItem("auth_token"),a="undefined"!=typeof FormData&&e.body instanceof FormData,n=new Headers(e.headers||{});n.has("Accept")||n.set("Accept","application/json");let o=void 0!==e.body&&null!==e.body&&""!==e.body;a||!o||n.has("Content-Type")||n.set("Content-Type","application/json"),r&&!n.has("Authorization")&&n.set("Authorization",`Bearer ${r}`);let i=t.startsWith("http")?t:`https://space-vpn.tech/api/v1${t}`;try{let t=await fetch(i,{...e,headers:n}),r=t.status,a=await t.text(),o=a?function(t){try{return JSON.parse(t)}catch{return t}}(a):void 0;if(!t.ok){if(422===r&&Array.isArray(o?.detail))return{error:o.detail.map(t=>`${t.loc?.join(" → ")||"Field"}: ${t.msg}`).join(", "),status:r};let t=o?.detail||o?.message||(Array.isArray(o?.errors)?o?.errors.join(", "):void 0);return{error:"string"==typeof t?t:`HTTP ${r}`,status:r}}return{data:o,status:r}}catch(t){return{error:t instanceof Error?t.message:"Network error"}}}async function i(t,e,r,a){return s("/auth/register",{method:"POST",body:JSON.stringify({username:t,email:e,password:r,full_name:a})})}async function u(t,e){let r=new URLSearchParams;r.append("username",t),r.append("password",e);let a=await s("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});return a.data?.access_token&&n(a.data.access_token),a}function c(){o(),localStorage.removeItem("current_user")}function l(){return null!==localStorage.getItem("auth_token")}async function d(){let t=await s("/users/me");return t.data&&localStorage.setItem("current_user",JSON.stringify(t.data)),t}t.s(["fetchAPI",()=>s,"removeAuthToken",()=>o,"setAuthToken",()=>n],50419);let f=(0,r.createContext)(void 0);function h({children:t}){let[n,o]=(0,r.useState)(null),[s,h]=(0,r.useState)(!0),g=(0,a.useRouter)();(0,r.useEffect)(()=>{(async()=>{if(l()){let t,e=(t=localStorage.getItem("current_user"))?JSON.parse(t):null;e&&o(e);let r=await d();r.data?o(r.data):401===r.status||403===r.status?(c(),o(null)):e||o(null)}h(!1)})()},[]);let m=async(t,e)=>{h(!0);try{let r=await u(t,e);if(r.data){let t=await d();if(t.data)return o(t.data),localStorage.setItem("current_user",JSON.stringify(t.data)),h(!1),{success:!0}}return h(!1),{success:!1,error:r.error||"Login failed"}}catch(t){return h(!1),{success:!1,error:t instanceof Error?t.message:"Login failed"}}},y=async(t,e,r,a)=>{h(!0);try{let n=await i(t,e,r,a);if(n.data)return await m(t,r);return h(!1),{success:!1,error:n.error||"Registration failed"}}catch(t){return h(!1),{success:!1,error:t instanceof Error?t.message:"Registration failed"}}},p=async()=>{if(l()){let t=await d();t.data?(o(t.data),localStorage.setItem("current_user",JSON.stringify(t.data))):(401===t.status||403===t.status)&&(c(),o(null))}};return(0,e.jsx)(f.Provider,{value:{user:n,loading:s,login:m,logout:()=>{c(),o(null),g.push("/login")},register:y,refreshUser:p},children:t})}function g(){let t=(0,r.useContext)(f);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}function m(t){return function(n){let{user:o,loading:s}=g(),i=(0,a.useRouter)();return((0,r.useEffect)(()=>{s||o||i.push("/login")},[o,s,i]),s)?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,e.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):o?(0,e.jsx)(t,{...n}):null}}t.s(["AuthProvider",()=>h,"useAuth",()=>g,"withAuth",()=>m],96636)}]);