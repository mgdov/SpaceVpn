(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25121,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},84654,(e,t,r)=>{t.exports=e.r(61938)},96636,e=>{"use strict";var t=e.i(19212),r=e.i(20278),a=e.i(84654);async function n(e,t={}){let r=localStorage.getItem("auth_token"),a="undefined"!=typeof FormData&&t.body instanceof FormData,o=new Headers(t.headers||{});o.has("Accept")||o.set("Accept","application/json");let s=void 0!==t.body&&null!==t.body&&""!==t.body;a||!s||o.has("Content-Type")||o.set("Content-Type","application/json"),r&&!o.has("Authorization")&&o.set("Authorization",`Bearer ${r}`);let i=e.startsWith("http")?e:`/api/v1${e}`;try{let e=await fetch(i,{...t,headers:o}),r=e.status,a=await e.text(),n=a?function(e){try{return JSON.parse(e)}catch{return e}}(a):void 0;if(!e.ok){if(422===r&&Array.isArray(n?.detail))return{error:n.detail.map(e=>`${e.loc?.join(" → ")||"Field"}: ${e.msg}`).join(", "),status:r};let e=n?.detail||n?.message||(Array.isArray(n?.errors)?n?.errors.join(", "):void 0);return{error:"string"==typeof e?e:`HTTP ${r}`,status:r}}return{data:n,status:r}}catch(e){return{error:e instanceof Error?e.message:"Network error"}}}async function o(e,t,r,a){return n("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,full_name:a})})}async function s(e,t){var r;let a=new URLSearchParams;a.append("username",e),a.append("password",t);let o=await n("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});return o.data?.access_token&&(r=o.data.access_token,localStorage.setItem("auth_token",r)),o}function i(){localStorage.removeItem("auth_token"),localStorage.removeItem("current_user")}function u(){return null!==localStorage.getItem("auth_token")}async function c(){let e=await n("/users/me");return e.data&&localStorage.setItem("current_user",JSON.stringify(e.data)),e}let l=(0,r.createContext)(void 0);function d({children:e}){let[n,d]=(0,r.useState)(null),[f,h]=(0,r.useState)(!0),m=(0,a.useRouter)();(0,r.useEffect)(()=>{(async()=>{if(u()){let e,t=(e=localStorage.getItem("current_user"))?JSON.parse(e):null;t&&d(t);let r=await c();r.data?d(r.data):r.error&&(i(),d(null))}h(!1)})()},[]);let y=async(e,t)=>{h(!0);try{let r=await s(e,t);if(r.data){let e=await c();if(e.data)return d(e.data),h(!1),{success:!0}}return h(!1),{success:!1,error:r.error||"Login failed"}}catch(e){return h(!1),{success:!1,error:e instanceof Error?e.message:"Login failed"}}},g=async(e,t,r,a)=>{h(!0);try{let n=await o(e,t,r,a);if(n.data)return await y(e,r);return h(!1),{success:!1,error:n.error||"Registration failed"}}catch(e){return h(!1),{success:!1,error:e instanceof Error?e.message:"Registration failed"}}},p=async()=>{if(u()){let e=await c();e.data&&d(e.data)}};return(0,t.jsx)(l.Provider,{value:{user:n,loading:f,login:y,logout:()=>{i(),d(null),m.push("/login")},register:g,refreshUser:p},children:e})}function f(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function h(e){return function(n){let{user:o,loading:s}=f(),i=(0,a.useRouter)();return((0,r.useEffect)(()=>{s||o||i.push("/login")},[o,s,i]),s)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):o?(0,t.jsx)(e,{...n}):null}}e.s(["AuthProvider",()=>d,"useAuth",()=>f,"withAuth",()=>h],96636)}]);