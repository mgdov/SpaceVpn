(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84654,(t,e,r)=>{e.exports=t.r(61938)},96134,50419,74349,t=>{"use strict";t.i(77442);function e(){return localStorage.getItem("auth_token")}function r(t){localStorage.setItem("auth_token",t)}function a(){localStorage.removeItem("auth_token")}async function n(t,r={}){let a=e(),o="undefined"!=typeof FormData&&r.body instanceof FormData,s=new Headers(r.headers||{});s.has("Accept")||s.set("Accept","application/json");let u=void 0!==r.body&&null!==r.body&&""!==r.body;o||!u||s.has("Content-Type")||s.set("Content-Type","application/json"),a&&!s.has("Authorization")&&s.set("Authorization",`Bearer ${a}`);let i=t.startsWith("http")?t:`https://space-vpn.tech/api/v1${t}`;try{let t=await fetch(i,{...r,headers:s}),e=t.status,a=await t.text(),n=a?function(t){try{return JSON.parse(t)}catch{return t}}(a):void 0;if(!t.ok){if(422===e&&Array.isArray(n?.detail))return{error:n.detail.map(t=>`${t.loc?.join(" → ")||"Field"}: ${t.msg}`).join(", "),status:e};let t=n?.detail||n?.message||(Array.isArray(n?.errors)?n?.errors.join(", "):void 0);return{error:"string"==typeof t?t:`HTTP ${e}`,status:e}}return{data:n,status:e}}catch(t){return{error:t instanceof Error?t.message:"Network error"}}}function o(t,e){if(!e)return t;let r=new URLSearchParams;Object.entries(e).forEach(([t,e])=>{null!=e&&r.append(t,String(e))});let a=r.toString();return a?`${t}?${a}`:t}async function s(t,e,r,a){return n("/auth/register",{method:"POST",body:JSON.stringify({username:t,email:e,password:r,full_name:a})})}async function u(t,e){let a=new URLSearchParams;a.append("username",t),a.append("password",e);let o=await n("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});return o.data?.access_token&&r(o.data.access_token),o}function i(){a(),localStorage.removeItem("current_user")}function c(){return null!==localStorage.getItem("auth_token")}async function l(){return n("/auth/oauth-providers")}async function d(){return n("/auth/google")}async function g(){return n("/auth/telegram")}async function f(t){let e=await n("/auth/telegram/callback",{method:"POST",body:JSON.stringify(t)});return e.data?.access_token&&r(e.data.access_token),e}async function h(){let t=await n("/users/me");return t.data&&localStorage.setItem("current_user",JSON.stringify(t.data)),t}function m(){let t=localStorage.getItem("current_user");return t?JSON.parse(t):null}function y(){return m()}function p(t){localStorage.setItem("current_user",JSON.stringify(t))}t.s(["fetchAPI",()=>n,"getAuthToken",()=>e,"removeAuthToken",()=>a,"setAuthToken",()=>r,"withQuery",()=>o],50419),t.s(["getGoogleAuthUrl",()=>d,"getOAuthProviders",()=>l,"getTelegramAuthInfo",()=>g,"isAuthenticated",()=>c,"loginUser",()=>u,"logoutUser",()=>i,"registerUser",()=>s,"telegramAuthCallback",()=>f],96134),t.s(["getCurrentUser",()=>y,"getCurrentUserInfo",()=>h,"getStoredUser",()=>m,"setCurrentUser",()=>p],74349)},96636,t=>{"use strict";var e=t.i(19212),r=t.i(20278),a=t.i(84654),n=t.i(96134),o=t.i(74349);let s=(0,r.createContext)(void 0);function u({children:t}){let[u,i]=(0,r.useState)(null),[c,l]=(0,r.useState)(!0),d=(0,a.useRouter)();(0,r.useEffect)(()=>{(async()=>{if((0,n.isAuthenticated)()){let t=(0,o.getStoredUser)();t&&i(t);let e=await (0,o.getCurrentUser)();e.data?i(e.data):401===e.status||403===e.status?((0,n.logoutUser)(),i(null)):t||i(null)}l(!1)})()},[]);let g=async(t,e)=>{l(!0);try{let r=await (0,n.loginUser)(t,e);if(r.data){let t=await (0,o.getCurrentUser)();if(t.data)return i(t.data),localStorage.setItem("current_user",JSON.stringify(t.data)),l(!1),{success:!0}}return l(!1),{success:!1,error:r.error||"Login failed"}}catch(t){return l(!1),{success:!1,error:t instanceof Error?t.message:"Login failed"}}},f=async(t,e,r,a)=>{l(!0);try{let o=await (0,n.registerUser)(t,e,r,a);if(o.data){let e=o.data.username||o.data.email||t;return await g(e,r)}return l(!1),{success:!1,error:o.error||"Registration failed"}}catch(t){return l(!1),{success:!1,error:t instanceof Error?t.message:"Registration failed"}}},h=async()=>{if((0,n.isAuthenticated)()){let t=await (0,o.getCurrentUser)();t.data?(i(t.data),localStorage.setItem("current_user",JSON.stringify(t.data))):(401===t.status||403===t.status)&&((0,n.logoutUser)(),i(null))}};return(0,e.jsx)(s.Provider,{value:{user:u,loading:c,login:g,logout:()=>{(0,n.logoutUser)(),i(null),d.push("/login")},register:f,refreshUser:h},children:t})}function i(){let t=(0,r.useContext)(s);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}function c(t){return function(n){let{user:o,loading:s}=i(),u=(0,a.useRouter)();return((0,r.useEffect)(()=>{s||o||u.push("/login")},[o,s,u]),s)?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,e.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):o?(0,e.jsx)(t,{...n}):null}}t.s(["AuthProvider",()=>u,"useAuth",()=>i,"withAuth",()=>c])}]);