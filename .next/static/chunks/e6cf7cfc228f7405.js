(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25121,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return a}});let a=e=>{}},84654,(e,t,r)=>{t.exports=e.r(61938)},96636,50419,e=>{"use strict";var t=e.i(19212),r=e.i(20278),a=e.i(84654);e.i(77442);function n(e){localStorage.setItem("auth_token",e)}function o(){localStorage.removeItem("auth_token")}async function s(e,t={}){let r=localStorage.getItem("auth_token"),a="undefined"!=typeof FormData&&t.body instanceof FormData,n=new Headers(t.headers||{});n.has("Accept")||n.set("Accept","application/json");let o=void 0!==t.body&&null!==t.body&&""!==t.body;a||!o||n.has("Content-Type")||n.set("Content-Type","application/json"),r&&!n.has("Authorization")&&n.set("Authorization",`Bearer ${r}`);let i=e.startsWith("http")?e:`https://space-vpn.tech/api/v1${e}`;try{let e=await fetch(i,{...t,headers:n}),r=e.status,a=await e.text(),o=a?function(e){try{return JSON.parse(e)}catch{return e}}(a):void 0;if(!e.ok){if(422===r&&Array.isArray(o?.detail))return{error:o.detail.map(e=>`${e.loc?.join(" → ")||"Field"}: ${e.msg}`).join(", "),status:r};let e=o?.detail||o?.message||(Array.isArray(o?.errors)?o?.errors.join(", "):void 0);return{error:"string"==typeof e?e:`HTTP ${r}`,status:r}}return{data:o,status:r}}catch(e){return{error:e instanceof Error?e.message:"Network error"}}}async function i(e,t,r,a){return s("/auth/register",{method:"POST",body:JSON.stringify({username:e,email:t,password:r,full_name:a})})}async function u(e,t){let r=new URLSearchParams;r.append("username",e),r.append("password",t);let a=await s("/auth/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r.toString()});return a.data?.access_token&&n(a.data.access_token),a}function c(){o(),localStorage.removeItem("current_user")}function l(){return null!==localStorage.getItem("auth_token")}async function d(){let e=await s("/users/me");return e.data&&localStorage.setItem("current_user",JSON.stringify(e.data)),e}e.s(["fetchAPI",()=>s,"removeAuthToken",()=>o,"setAuthToken",()=>n],50419);let f=(0,r.createContext)(void 0);function h({children:e}){let[n,o]=(0,r.useState)(null),[s,h]=(0,r.useState)(!0),g=(0,a.useRouter)();(0,r.useEffect)(()=>{(async()=>{if(l()){let e,t=(e=localStorage.getItem("current_user"))?JSON.parse(e):null;t&&o(t);let r=await d();r.data?o(r.data):401===r.status||403===r.status?(c(),o(null)):t||o(null)}h(!1)})()},[]);let m=async(e,t)=>{h(!0);try{let r=await u(e,t);if(r.data){let e=await d();if(e.data)return o(e.data),localStorage.setItem("current_user",JSON.stringify(e.data)),h(!1),{success:!0}}return h(!1),{success:!1,error:r.error||"Login failed"}}catch(e){return h(!1),{success:!1,error:e instanceof Error?e.message:"Login failed"}}},y=async(e,t,r,a)=>{h(!0);try{let n=await i(e,t,r,a);if(n.data)return await m(e,r);return h(!1),{success:!1,error:n.error||"Registration failed"}}catch(e){return h(!1),{success:!1,error:e instanceof Error?e.message:"Registration failed"}}},p=async()=>{if(l()){let e=await d();e.data?(o(e.data),localStorage.setItem("current_user",JSON.stringify(e.data))):(401===e.status||403===e.status)&&(c(),o(null))}};return(0,t.jsx)(f.Provider,{value:{user:n,loading:s,login:m,logout:()=>{c(),o(null),g.push("/login")},register:y,refreshUser:p},children:e})}function g(){let e=(0,r.useContext)(f);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function m(e){return function(n){let{user:o,loading:s}=g(),i=(0,a.useRouter)();return((0,r.useEffect)(()=>{s||o||i.push("/login")},[o,s,i]),s)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Загрузка..."})}):o?(0,t.jsx)(e,{...n}):null}}e.s(["AuthProvider",()=>h,"useAuth",()=>g,"withAuth",()=>m],96636)}]);